{%  extends 'admin/main.html' %}
{% load static %}
{% load humanize %}

{% block content %}
 <div class="container-fluid">
          <!-- Page Heading -->
	<div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="h3 mb-0 text-gray-800">Barang</h1>
		<button type="button" data-toggle="modal" data-target="#barangModal" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-plus"></i> Add Barang</button>
	</div>
</div>
<style>
	#tablebarang_filter{
		float: right;
	}
	#tablebarang_paginate{
		float: right;
	}
</style>
<div class="container-fluid">
	<div class="table-responsive mb-4 p-2">
	  <table id="tablebarang" class="table table-bordered table-striped w-100" style="color: black;">
	    <thead>
	      <tr>
	        <th scope="col">Nama Barang</th>
	        <th scope="col">Kategori</th>
	        <th scope="col">Stok</th>
	        <th scope="col">Harga Beli</th>
	        <th scope="col">Harga Jual</th>
	        <th scope="col">Action</th>
	      </tr>
	    </thead>
	    <tbody>
	    {% for i in dbarang %}
	      <tr>
	        <td>{{i.nama}}</td>
	        <td>{{i.kategori}}</td>
			<td>{{i.stok}}</td>
			<td>Rp.{{i.harga_beli|intcomma }}</td>
			<td>Rp.{{i.harga_jual|intcomma }}</td>
			<td>
				<form action="{% url 'delBarang' i.id %}" method="post" style="display: inline-block;">
				{%csrf_token%}
				<button type="submit" class="btn btn-danger btn-sm">Hapus</button>
				</form>
				<button type="button" data-toggle="modal" data-target="#barangEditModal" data-kategori="{{i.kategori.id}}" data-nama="{{i.nama}}" data-stok="{{i.stok}}" data-id="{{i.id}}" data-hargabeli="{{i.harga_beli}}" data-hargajual="{{i.harga_jual}}" class="btn btn-info btn-sm mr-2">Edit</button>
			</td>
	      </tr>
	    {% endfor %}
	    </tbody>
	  </table>
	</div>
</div>

<div class="modal fade" id="barangModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalLabel">Tambah Barang</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <form action="" method="post">
	        	{% csrf_token %}
			  <div class="form-group">
			    <label for="exampleInputEmail1">Nama Barang</label>
			    {{form.nama}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Kategori Barang</label>
			    {{form.kategori}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Stok Barang</label>
			    {{form.stok}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Harga Jual</label>
			    {{form.harga_jual}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Harga Beli</label>
			    {{form.harga_beli}}
			  </div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	        <button type="submit" id="btnSave" class="btn btn-primary">Tambah</button>
	      </div>
	      </form>
	    </div>
		</div>
	</div>
</div>	

<div class="modal fade" id="barangEditModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalLabel">Edit Barang</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <form action="{% url 'upBarang' %}" method="post">
	        	{% csrf_token %}
	        	{{formup.pk.as_hidden}}
			  <div class="form-group">
			    <label for="exampleInputEmail1">Nama Barang</label>
			    {{formup.nama}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Kategori Barang</label>
			    {{formup.kategori}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Stok Barang</label>
			    {{formup.stok}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Harga Jual</label>
			    {{formup.harga_jual}}
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">Harga Beli</label>
			    {{formup.harga_beli}}
			  </div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	        <button type="submit" id="btnSave" class="btn btn-primary">Simpan Perubahan</button>
	      </div>
	      </form>
	    </div>
		</div>
	</div>
</div>	

<script>
	$(document).ready(function(){
		$('#id_kategori').select2({
			width: '100%'
		});
	});
</script>

<script type="text/javascript">
  $('#barangEditModal').on('show.bs.modal', function (event){
    console.log('modalopened');
    var button = $(event.relatedTarget);
    var id = button.data('id');
    var nama = button.data('nama');
    var kategori = button.data('kategori');
    var stok = button.data('stok');
    var hargajual = button.data('hargajual');
    var hargabeli = button.data('hargabeli');

    var modal = $(this);
    modal.find('#id_nama').val(nama);
    modal.find('#id_pk').val(id);
    modal.find('#id_kategori').val(kategori);
    modal.find('#id_stok').val(stok);
    modal.find('#id_harga_jual').val(hargajual);
    modal.find('#id_harga_beli').val(hargabeli);
  })
</script>

<script>
	$(document).ready(function() {
	    var table = $('#tablebarang').DataTable( {
	    	"columnDefs": [
			    { "orderable": false, "searchable": false, "targets": 5 }
			  ],
	        buttons:[	
	        			{
		                  extend: 'excelHtml5',
		                    exportOptions: {
		                        columns: ':visible'
		                    }
		                },

                		{
	            			extend: 'print',
			                exportOptions: {
			                    columns: ':visible'
	                		}
                		},
                		'colvis',
        			],
        	"aLengthMenu": [[5,10,25,-1],[5,10,25, "All"]],
			"iDisplayLength": 10
	    } );
	 
	    table.buttons().container()
	        .appendTo( '#tablebarang_wrapper .col-md-6:eq(0)' );
	} );
/* Because i didnt set placeholder values in forms.py they will be set here using vanilla Javascript
//We start indexing at one because CSRF_token is considered and input field
 */

//Query All input fields
var select_fields = document.getElementsByTagName('select')

var input_fields = document.getElementsByTagName('input')


for (var field in select_fields){
  select_fields[field].className += ' form-control'
}
for (var field in input_fields){
  input_fields[field].className += ' form-control'
}
</script>

{% endblock %}